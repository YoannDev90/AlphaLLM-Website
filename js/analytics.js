class PrivacyAnalytics{constructor(){this.initialized=!1,this.userId=this.generateUserId(),this.sessionId=this.generateSessionId(),this.init()}init(){this.initialized||this.waitForPlausible().then(()=>{this.setupCustomEvents(),this.trackInitialLoad(),this.trackThemeChanges(),this.trackUserInteractions(),this.trackPerformanceMetrics(),this.trackErrorEvents(),this.initialized=!0})}waitForPlausible(){return new Promise(e=>{const t=()=>{"undefined"!=typeof plausible?e():setTimeout(t,100)};t()})}generateUserId(){let e=localStorage.getItem("analytics_user_id");return e||(e="user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem("analytics_user_id",e)),e}generateSessionId(){return"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}setupCustomEvents(){}trackInitialLoad(){"undefined"!=typeof plausible&&plausible("pageview",{props:{theme:this.getCurrentTheme(),language:this.getCurrentLanguage(),device:this.getDeviceCategory()}})}trackThemeChanges(){new MutationObserver(e=>{e.forEach(e=>{if("data-theme"===e.attributeName){const t=document.documentElement.getAttribute("data-theme");this.trackCustomEvent("theme_change",{theme:t,previous_theme:e.oldValue})}})}).observe(document.documentElement,{attributes:!0,attributeOldValue:!0,attributeFilter:["data-theme"]})}trackUserInteractions(){document.addEventListener("click",e=>{const t=e.target.closest("[data-track]");if(t){const e=t.getAttribute("data-track");this.trackCustomEvent("button_click",{button_name:e,page:window.location.pathname})}if(e.target.closest('a[href^="http"]')){const t=e.target.closest("a");t.href.includes(window.location.hostname)||this.trackCustomEvent("external_link_click",{link_url:t.href,link_text:t.textContent.trim()})}});let e=Date.now(),t=0;const n=()=>{t++};document.addEventListener("click",n),document.addEventListener("scroll",n),document.addEventListener("keydown",n),setInterval(()=>{const n=Math.floor((Date.now()-e)/1e3);this.trackCustomEvent("time_engagement",{time_spent:n,interactions:t,page:window.location.pathname})},3e4),window.addEventListener("beforeunload",()=>{const n=Math.floor((Date.now()-e)/1e3);this.trackCustomEvent("page_exit",{total_time:n,final_interactions:t})})}trackPerformanceMetrics(){if("PerformanceObserver"in window)try{new PerformanceObserver(e=>{const t=e.getEntries(),n=t[t.length-1];this.trackCustomEvent("web_vitals_lcp",{value:Math.round(n.startTime),rating:this.getWebVitalRating("LCP",n.startTime)})}).observe({entryTypes:["largest-contentful-paint"]});new PerformanceObserver(e=>{e.getEntries().forEach(e=>{this.trackCustomEvent("web_vitals_fid",{value:Math.round(e.processingStart-e.startTime),rating:this.getWebVitalRating("FID",e.processingStart-e.startTime)})})}).observe({entryTypes:["first-input"]});let e=0;new PerformanceObserver(t=>{t.getEntries().forEach(t=>{t.hadRecentInput||(e+=t.value)})}).observe({entryTypes:["layout-shift"]}),setTimeout(()=>{this.trackCustomEvent("web_vitals_cls",{value:Math.round(1e3*e)/1e3,rating:this.getWebVitalRating("CLS",e)})},5e3)}catch(e){console.warn("Performance tracking not fully supported:",e)}this.trackCustomEvent("device_info",{viewport_width:window.innerWidth,viewport_height:window.innerHeight,device_pixel_ratio:window.devicePixelRatio,device_category:this.getDeviceCategory()})}trackErrorEvents(){if(window.errorTracker){const e=window.errorTracker.trackError;window.errorTracker.trackError=t=>{e.call(window.errorTracker,t),this.trackCustomEvent("javascript_error",{type:t.type||"unknown",message:t.message?.substring(0,100),filename:t.filename,lineno:t.lineno,page:window.location.pathname})}}}getCurrentTheme(){return document.documentElement.getAttribute("data-theme")||"dark"}getCurrentLanguage(){return localStorage.getItem("language")||"fr"}getDeviceCategory(){const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}getWebVitalRating(e,t){switch(e){case"LCP":return t<=2500?"good":t<=4e3?"needs-improvement":"poor";case"FID":return t<=100?"good":t<=300?"needs-improvement":"poor";case"CLS":return t<=.1?"good":t<=.25?"needs-improvement":"poor";default:return"unknown"}}trackCustomEvent(e,t={}){"undefined"!=typeof plausible?plausible(e,{props:t}):console.log("Plausible event:",e,t)}trackConversion(e,t=null){this.trackCustomEvent("conversion",{type:e,value:t})}getAnonymousInsights(){return{theme:this.getCurrentTheme(),language:this.getCurrentLanguage(),device:this.getDeviceCategory(),sessionId:this.sessionId}}}const privacyAnalytics=new PrivacyAnalytics;"undefined"!=typeof module&&module.exports&&(module.exports=PrivacyAnalytics),"undefined"!=typeof window&&(window.PrivacyAnalytics=PrivacyAnalytics,window.privacyAnalytics=privacyAnalytics);